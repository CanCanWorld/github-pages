(function(){"use strict";var t={6050:function(t,e,a){var s=a(20144),o=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"right-box"},[t.isConnect?e("div",[e("i",{staticClass:"el-icon-success",staticStyle:{color:"#68c13c"}}),e("span",{staticStyle:{color:"#68c13c"}},[t._v("连接成功")])]):e("div",[e("i",{staticClass:"el-icon-error",staticStyle:{color:"#f36b6b"}}),e("span",{staticStyle:{color:"#f36b6b"}},[t._v("连接关闭")])])]),e("el-tabs",{staticClass:"main-box",model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:"请求码统计",name:"0"}},[e("el-select",{attrs:{multiple:"",placeholder:"请选择"},model:{value:t.selectedStatus,callback:function(e){t.selectedStatus=e},expression:"selectedStatus"}},t._l(t.status,(function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),e("pie-chart",{attrs:{data:t.pieData}}),e("log-table",{attrs:{"table-data":t.statusTableData}})],1),e("el-tab-pane",{attrs:{label:"起止时间统计",name:"1"}},[e("el-date-picker",{attrs:{type:"daterange",align:"right","value-format":"yyyy-MM-dd HH:mm:ss","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:t.timeChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),e("horizontal-bar-chart",{attrs:{data:t.barData}}),e("log-table",{attrs:{"table-data":t.timeTableData}})],1),e("el-tab-pane",{attrs:{label:"故障统计",name:"2"}},[e("el-checkbox-group",{model:{value:t.normalState,callback:function(e){t.normalState=e},expression:"normalState"}},[e("el-checkbox",{attrs:{label:"1",border:""}},[t._v("正常")]),e("el-checkbox",{attrs:{label:"-1",border:""}},[t._v("故障")])],1),e("pie-chart",{attrs:{data:t.normalPieData}}),e("log-table",{attrs:{"table-data":t.normalTableData}})],1),e("el-tab-pane",{attrs:{label:"安全统计",name:"3"}},[e("el-checkbox-group",{model:{value:t.safeType,callback:function(e){t.safeType=e},expression:"safeType"}},[e("el-checkbox",{attrs:{label:"assault_xss",border:""}},[t._v("XSS攻击")]),e("el-checkbox",{attrs:{label:"assault_file",border:""}},[t._v("敏感文件攻击")]),e("el-checkbox",{attrs:{label:"assault_comm",border:""}},[t._v("命令执行攻击")]),e("el-checkbox",{attrs:{label:"assault_sqlinj",border:""}},[t._v("sql注入攻击")]),e("el-checkbox",{attrs:{label:"assault_webshell",border:""}},[t._v("webshell连接攻击")])],1),e("vertical-bar-chart",{attrs:{data:t.safeBarData}}),e("log-table",{attrs:{"table-data":t.safeTableData}})],1)],1)],1)},l=[],i=(a(70560),a(5121));const r=i.Z.create({baseURL:"/api",timeout:2e4});var n=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"echart",staticStyle:{width:"600px",height:"400px",margin:"10px"}})])},h=[],c={name:"PieChart",props:["data"],data(){return{myChart:null,options:""}},mounted(){this.myChart=this.$echarts.init(this.$refs.echart),this.drawChart()},watch:{data(){this.options={title:{text:"状态码统计",subtext:"Analog",left:"center"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"状态码统计",type:"pie",radius:"50%",data:this.data,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}},options(){this.myChart.clear(),this.myChart.setOption(this.options)}},methods:{drawChart(){this.myChart.setOption(this.options)}}},u=c,p=a(1001),m=(0,p.Z)(u,n,h,!1,null,"265e361c",null),b=m.exports,d=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"echart",staticClass:"echart"})])},g=[],f={name:"HorizontalBarChart",props:["data"],data(){return{myChart:null,options:""}},mounted(){this.myChart=this.$echarts.init(this.$refs.echart),this.drawChart()},watch:{data(){this.options={title:{text:"请求数统计"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{},xAxis:{type:"value",boundaryGap:[0,.01],splitLine:{show:!1}},yAxis:{type:"category",data:this.data.yAxis,axisLabel:{margin:-2,interval:0,color:["#000000"],align:"left",verticalAlign:"bottom",lineHeight:30,fontSize:13},axisLine:{show:!1},axisTick:{show:!1},z:99},series:[{name:"请求数",type:"bar",barWidth:20,data:this.data.series,showBackground:!0,label:{show:!0},color:"#536fc4"}]}},options(){this.myChart.clear(),this.myChart.setOption(this.options)}},methods:{drawChart(){this.myChart.setOption(this.options)}}},w=f,v=(0,p.Z)(w,d,g,!1,null,"09306f24",null),y=v.exports,_=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table-box"},[e("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",stripe:"true",border:"true",data:t.tableData.logs.slice((t.tableData.page-1)*t.tableData.limit,t.tableData.page*t.tableData.limit)}},[e("el-table-column",{attrs:{align:"center",prop:"remote_addr","show-overflow-tooltip":!0,label:"remote_addr",width:"120"}}),e("el-table-column",{attrs:{prop:"remote_user",align:"center","show-overflow-tooltip":!0,label:"remote_user",width:"120"}}),e("el-table-column",{attrs:{prop:"time_local",align:"center",width:"100","show-overflow-tooltip":!0,label:"time_local"}}),e("el-table-column",{attrs:{align:"center",prop:"request","show-overflow-tooltip":!0,label:"request"}}),e("el-table-column",{attrs:{align:"center","show-overflow-tooltip":!0,prop:"status",width:"60",label:"status"}}),e("el-table-column",{attrs:{prop:"body_bytes_sent",align:"center","show-overflow-tooltip":!0,width:"140",label:"body_bytes_sent"}}),e("el-table-column",{attrs:{prop:"http_referer",width:"120",align:"center","show-overflow-tooltip":!0,label:"http_referer"}}),e("el-table-column",{attrs:{prop:"http_user_agent",align:"center","show-overflow-tooltip":!0,width:"140",label:"http_user_agent"}}),e("el-table-column",{attrs:{align:"center",prop:"http_x_forwarded_for","show-overflow-tooltip":!0,width:"160",label:"http_x_forwarded_for"}}),e("el-table-column",{attrs:{prop:"normal","show-overflow-tooltip":!0,width:"80",align:"center",label:"正常"}}),e("el-table-column",{attrs:{prop:"assault_xss",align:"center","show-overflow-tooltip":!0,width:"80",label:"XSS攻击"}}),e("el-table-column",{attrs:{prop:"assault_file",width:"100","show-overflow-tooltip":!0,align:"center",label:"敏感文件攻击"}}),e("el-table-column",{attrs:{prop:"assault_comm",align:"center","show-overflow-tooltip":!0,width:"100",label:"命令执行攻击"}}),e("el-table-column",{attrs:{prop:"assault_sqlinj",align:"center","show-overflow-tooltip":!0,width:"100",label:"sql注入攻击"}}),e("el-table-column",{attrs:{prop:"assault_webshell",align:"center","show-overflow-tooltip":!0,width:"140",label:"webshell连接攻击"}})],1),e("el-pagination",{attrs:{background:"","current-page":t.tableData.page,"page-size":t.tableData.limit,"pager-count":11,layout:"prev, pager, next",total:t.tableData.logs.length},on:{"current-change":t.handleCurrentChange}})],1)},T=[],x={name:"LogTable",props:["tableData"],methods:{handleCurrentChange(t){console.log("page: ",t),this.tableData.page=t}}},S=x,D=(0,p.Z)(S,_,T,!1,null,"0193086a",null),C=D.exports,k=function(){var t=this,e=t._self._c;return e("div",[e("div",{ref:"echart",staticClass:"echart"})])},O=[],L={name:"VerticalBarChart",props:["data"],data(){return{myChart:null,options:""}},mounted(){this.myChart=this.$echarts.init(this.$refs.echart),this.drawChart()},watch:{data(){this.options={xAxis:{type:"category",data:["XSS攻击","敏感文件攻击","命令执行攻击","sql注入攻击","webshell连接攻击"]},yAxis:{type:"value"},series:[{data:this.data,type:"bar",label:{show:!0}}]}},options(){this.myChart.clear(),this.myChart.setOption(this.options)}},methods:{drawChart(){this.myChart.setOption(this.options)}}},j=L,B=(0,p.Z)(j,k,O,!1,null,"3fc7410f",null),q=B.exports,P={name:"App",components:{VerticalBarChart:q,LogTable:C,HorizontalBarChart:y,PieChart:b},data(){return{activeName:"0",status:[],selectedStatus:[],tableData:[],statusTableData:{logs:[],limit:10,page:1},timeTableData:{logs:[],limit:10,page:1},normalTableData:{logs:[],limit:10,page:1},safeTableData:{logs:[],limit:10,page:1},pieData:[],normalPieData:[],barData:[],safeBarData:[],statusList:[],normalList:[],time:"",normalState:["1","-1"],safeType:["assault_xss","assault_file","assault_comm","assault_sqlinj","assault_webshell"],ws:null,lockReconnect:!1,timeout:1e4,timeoutObj:null,serverTimeoutObj:null,timeoutnum:null,wsUrl:"ws://localhost:250/socket",msg:[],inputMsg:"",isConnect:!1}},mounted(){this.load()},created(){this.initWebpack()},beforeDestroy(){this.destroySocket()},watch:{selectedStatus(){this.statusTableData.page=1,this.getLogByStatus(),this.pieData=[],this.selectedStatus.forEach((t=>{this.statusList.forEach((e=>{t===e.status&&this.pieData.push({value:e.count,name:t})}))}))},normalState(){this.normalTableData.page=1,this.getLogByNormal(),this.normalPieData=[],this.normalState.forEach((t=>{this.normalList.forEach((e=>{t===e.normal&&this.normalPieData.push({value:e.count,name:"1"===e.normal?"正常":"故障"})}))}))},safeType(){this.safeTableData.page=1,this.getLogBySafeType()}},methods:{load(){this.getStatus(),this.getRequest(),this.getNormal(),this.getLogByStatus(),this.getLogByTime(),this.getLogByNormal(),this.getLogBySafeType()},destroySocket(){this.ws.close(),this.ws=null,clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj),clearTimeout(this.timeoutnum)},initWebpack(){this.ws=new WebSocket(this.wsUrl),this.ws.onopen=this.onopen,this.ws.onmessage=this.onmessage,this.ws.onclose=this.onclose,this.ws.onerror=this.onerror},reconnect(){const t=this;t.lockReconnect||(t.lockReconnect=!0,t.timeoutnum&&clearTimeout(t.timeoutnum),t.timeoutnum=setTimeout((function(){t.initWebpack(),t.lockReconnect=!1}),5e3))},reset(){const t=this;clearTimeout(t.timeoutObj),clearTimeout(t.serverTimeoutObj),t.start()},start(){const t=this;t.timeoutObj&&clearTimeout(t.timeoutObj),t.serverTimeoutObj&&clearTimeout(t.serverTimeoutObj),t.timeoutObj=setTimeout((function(){1===t.ws.readyState?t.ws.send("ping"):t.reconnect(),t.serverTimeoutObj=setTimeout((function(){t.ws.close()}),t.timeout)}),t.timeout)},onopen(){this.isConnect=!0,console.log("连接成功"),this.$message({message:"连接成功",type:"success"}),1===this.ws.readyState&&this.ws.send("链接成功后先发给后台的信息"),this.start()},onmessage(t){"pong"!==t.data&&(this.msg.push(t.data),console.log("收到后台信息: "+t.data),this.$message({message:t.data,type:"warning"}),this.load(),this.reset())},onclose(t){console.log("连接关闭"),this.isConnect=!1,this.$message.error("连接关闭"),this.reconnect()},onerror(t){console.log("出现错误"),this.reconnect()},sendMessage(){this.ws.send(this.inputMsg),this.inputMsg=""},getStatus(){r.post("/log/getStatus",{}).then((t=>{console.log(t),this.statusList=[],this.statusList.push(...t.data),this.selectedStatus=[],t.data.forEach((t=>{this.status.push({value:t.status,label:t.status}),this.selectedStatus.push(t.status)}))}))},getNormal(){r.post("/log/getNormal",{}).then((t=>{this.normalList=[],this.normalList.push(...t.data),this.normalPieData=[],t.data.forEach((t=>{this.normalPieData.push({value:t.count,name:"1"===t.normal?"正常":"故障"})}))}))},getRequest(){r.post("/log/getRequest",{startTime:this.time[0],endTime:this.time[1]}).then((t=>{console.log(t),this.barData=[];let e=[],a=[];t.data.slice(0,10).forEach((t=>{e.push(t.request),a.push(t.count)})),this.barData={yAxis:e.reverse(),series:a.reverse()}}))},getLogByStatus(){r.post("/log/getLogByStatus",{status:this.selectedStatus}).then((t=>{this.statusTableData.logs=[],this.statusTableData.logs.push(...t.data)}))},getLogByTime(){r.post("/log/getLogByTime",{startTime:this.time[0],endTime:this.time[1]}).then((t=>{this.timeTableData.logs=[],this.timeTableData.logs.push(...t.data)}))},getLogByNormal(){r.post("/log/getLogByNormal",{normal:this.normalState}).then((t=>{this.normalTableData.logs=[],this.normalTableData.logs.push(...t.data)}))},getLogBySafeType(){r.post("/log/getLogBySafeType",{type:this.safeType}).then((t=>{this.safeTableData.logs=[],this.safeTableData.logs.push(...t.data);let e=0,a=0,s=0,o=0,l=0;this.safeTableData.logs.forEach((t=>{"1"===t.assault_xss&&e++,"1"===t.assault_file&&a++,"1"===t.assault_comm&&s++,"1"===t.assault_sqlinj&&o++,"1"===t.assault_webshell&&l++})),this.safeBarData=[e,a,s,o,l]}))}}},N=P,$=(0,p.Z)(N,o,l,!1,null,null,null),A=$.exports,E=a(64720),M=a.n(E),R=a(70596),z=a.n(R);s["default"].prototype.$echarts=z(),s["default"].config.productionTip=!1,s["default"].use(M()),new s["default"]({render:t=>t(A)}).$mount("#app")}},e={};function a(s){var o=e[s];if(void 0!==o)return o.exports;var l=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(l.exports,l,l.exports,a),l.loaded=!0,l.exports}a.m=t,function(){a.amdO={}}(),function(){var t=[];a.O=function(e,s,o,l){if(!s){var i=1/0;for(c=0;c<t.length;c++){s=t[c][0],o=t[c][1],l=t[c][2];for(var r=!0,n=0;n<s.length;n++)(!1&l||i>=l)&&Object.keys(a.O).every((function(t){return a.O[t](s[n])}))?s.splice(n--,1):(r=!1,l<i&&(i=l));if(r){t.splice(c--,1);var h=o();void 0!==h&&(e=h)}}return e}l=l||0;for(var c=t.length;c>0&&t[c-1][2]>l;c--)t[c]=t[c-1];t[c]=[s,o,l]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){a.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var o,l,i=s[0],r=s[1],n=s[2],h=0;if(i.some((function(e){return 0!==t[e]}))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(n)var c=n(a)}for(e&&e(s);h<i.length;h++)l=i[h],a.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return a.O(c)},s=self["webpackChunkanalog_vue"]=self["webpackChunkanalog_vue"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(6050)}));s=a.O(s)})();
//# sourceMappingURL=app.614b0933.js.map